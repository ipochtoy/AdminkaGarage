# AdminkaGarage - Статус проекта

**Дата обновления:** 23 ноября 2025 (v1.3.0)

## Описание
Laravel + Filament админка для управления товарами e-commerce с AI-функциями.

## Стек технологий
- Laravel 12
- Filament 3
- Livewire + Alpine.js
- MySQL
- Telegram Bot API

---

## Реализованные функции

### 1. Управление фото
- **Telegram Bot** - загрузка фото через Telegram с сохранением EXIF
- **Bulk Upload** - веб-интерфейс для загрузки папок с фильтром по дате
- **Галерея фото** - просмотр, поворот, удаление, выбор главного фото
- **Lightbox** - увеличение по клику

### 2. AI интеграция

#### Генерация описаний
- **OpenAI GPT-5.1** - генерация описаний товаров
- **Gemini 3 Pro Preview** - альтернативный AI провайдер
- Автозаполнение: название, описание, бренд, категория, размер, цвет, состояние, цена

#### Обработка изображений (FASHN API)
- **Кнопка FASHN** - генерация модели в одежде
  - Рандомные модели (определение пола по названию)
  - Рандомные фоны
  - Удаление ценников
- **Кнопка Magic** - замена фона на студийный/градиент
  - Сохраняет состояние товара
  - Убирает вешалки и бирки

### 3. Рекомендации по цене (v1.3.0 - NEW!)
- **UPC/Barcode поиск** - автоматический поиск цен по баркодам через UPCitemdb API
  - Показ цен от магазинов: 6pm, Moosejaw, Home Depot, Zappos, Sportsman's Guide и др.
  - Прямые ссылки на товары в магазинах
  - Кеширование результатов на 7 дней
- **eBay поиск** - поиск похожих товаров через eBay Finding API
  - Медиана, минимум, максимум цен
  - Поддержка Sandbox и Production окружений
  - Кеширование на 24 часа для экономии лимитов API
- **AI оценка** - автоматическая оценка цены от Gemini AI
  - Диапазон цен (мин/макс)
  - Оценка на основе бренда, состояния, категории
- **Клик для установки** - любую цену можно применить одним кликом
- **Средняя цена** - автоматический расчет средней цены по всем источникам

### 4. Сканирование баркодов
- Выделение GG лейблов (оранжевым)
- Сохранение баркодов при удалении фото (перенос на другие фото)
- Автоматическая интеграция с UPC поиском цен

### 5. Предпросмотр товара
- Модальное окно с данными из формы
- Поддержка темной темы

### 6. Голосовые правки (В процессе)
- Web Speech API для голосового ввода
- AI переписывает на основе правок
- Автообновление полей формы

---

## Ключевые сервисы

| Сервис | Назначение |
|--------|------------|
| `GeminiService` | Gemini API для описаний и оценки цен |
| `AIService` | Интеграция OpenAI |
| `FashnService` | FASHN AI для генерации изображений |
| `EbayService` | Поиск цен на eBay (кеширование 24ч) |
| `UPCService` | Поиск по баркодам UPCitemdb (кеширование 7 дней) |

---

## Конфигурация

### Переменные окружения (.env)
```
TELEGRAM_BOT_TOKEN=xxx
FASHN_API_KEY=xxx
GEMINI_API_KEY=xxx
OPENAI_API_KEY=xxx

# eBay API (v1.3.0)
EBAY_APP_ID=xxx                    # Production App ID
EBAY_DEV_ID=xxx
EBAY_CERT_ID=xxx
EBAY_SANDBOX_APP_ID=xxx            # Sandbox для тестов
EBAY_SANDBOX_CERT_ID=xxx
EBAY_ENVIRONMENT=production        # или sandbox

# UPCitemdb API (v1.3.0)
UPCITEMDB_API_KEY=xxx
```

### Запуск бота
```bash
php artisan telegram:bot
```

### Запуск приложения
```bash
php artisan serve
```

Админка: http://localhost:8000/admin

---

## Изменения 23 ноября 2025

1. FASHN API интеграция с индикаторами загрузки
2. Кнопка Magic для замены фона
3. Lightbox для фото
4. Предпросмотр товара с данными формы
5. Сохранение баркодов при удалении фото
6. Компонент голосовых правок (UI готов)
7. Исправлен CSRF токен для bulk upload
8. Увеличен таймаут Gemini до 120сек
9. Коллапсируемый AI результат

---

## Структура файлов

```
app/
├── Console/Commands/
│   └── TelegramBotCommand.php      # Telegram бот
├── Filament/
│   ├── Resources/
│   │   ├── PhotoBatchResource.php  # Основной ресурс товаров
│   │   └── PhotoBatchResource/Pages/
│   │       └── EditPhotoBatch.php  # Страница редактирования
│   └── Pages/
│       └── BulkUpload.php          # Массовая загрузка
├── Services/
│   ├── GeminiService.php           # Gemini AI
│   ├── AIService.php               # OpenAI
│   ├── FashnService.php            # FASHN image AI
│   └── EbayService.php             # Цены eBay
└── Http/Controllers/Api/
    └── VoiceCorrectionController.php

resources/views/filament/
├── forms/components/
│   ├── photo-gallery.blade.php     # Галерея фото
│   ├── product-preview.blade.php   # Предпросмотр
│   ├── price-suggestions.blade.php # Цены eBay
│   └── voice-correction.blade.php  # Голосовой ввод
└── pages/
    └── bulk-upload.blade.php       # UI массовой загрузки
```

---

## TODO

- [ ] Завершить обработку голосовых правок через AI
- [ ] Добавить больше AI провайдеров
- [ ] Улучшить точность сканирования баркодов
- [ ] Добавить пакетные операции
- [ ] Экспорт на маркетплейсы

---

## Заметки

- Генерация FASHN занимает 1-2 минуты
- Таймаут Gemini 120 секунд для анализа изображений
- Фото хранятся в `storage/app/public/`
- Бот работает в режиме long polling

---

## История версий

### v1.3.0 (23 ноября 2025) - Система рекомендаций цен
**Добавлено:**
- ✅ UPCitemdb API интеграция
  - Автоматический поиск цен по баркодам
  - Поддержка 10+ популярных магазинов (6pm, Moosejaw, Home Depot, Zappos, и др.)
  - Прямые ссылки на товары в магазинах
  - Кеширование результатов на 7 дней
- ✅ eBay Finding API интеграция
  - Поиск похожих товаров по бренду/названию/баркоду
  - Расчет медианы, min/max цен
  - Поддержка Production и Sandbox окружений
  - Кеширование на 24 часа
  - Rate limiting защита (5000 вызовов/день)
- ✅ Улучшенный блок "Рекомендации по цене"
  - Визуализация цен из всех источников (AI + UPC + eBay)
  - Цветовое кодирование по источникам
  - Клик для установки цены
  - Автоматический расчет средней цены
- ✅ AI оценка цен через Gemini
  - Диапазон цен (min/max/оценка)
  - Учет бренда, состояния, категории товара

**Технические улучшения:**
- Добавлены новые ENV переменные для eBay и UPCitemdb
- Реализовано кеширование для минимизации API вызовов
- Добавлена обработка ошибок и rate limiting
- Поддержка Sandbox/Production переключения

**Известные ограничения:**
- eBay API: лимит 5000 вызовов/день (Production)
- UPCitemdb: бесплатный тариф имеет ограничения
- Кеш хранится 7-24 часа в зависимости от источника

### v1.2.0 (ранее)
- FASHN AI модели
- Голосовые правки (в процессе)
- Telegram bot интеграция
- Gemini/OpenAI описания

### v1.1.0 (ранее)
- Базовый функционал Filament
- Управление фото
- Сканирование баркодов
